async function analyzeVideo() {
    const urlInput = document.getElementById('videoUrl').value;
    const resultArea = document.getElementById('resultArea');
    const loading = document.getElementById('loading');
    const aiReason = document.getElementById('aiReason');
    
    if(!urlInput) return alert("Please paste a link!");

    resultArea.classList.add('hidden');
    loading.classList.remove('hidden');

    try {
        const response = await fetch('/api/analyze', {
            method: 'POST',
            body: JSON.stringify({ url: urlInput })
        });

        const data = await response.json();

        if (data.analysis) {
            document.getElementById('thumb').src = `https://img.youtube.com/vi/${urlInput.split('v=')[1]?.split('&')[0]}/mqdefault.jpg`;
            
            // Clean markdown and render as HTML
            let cleanHtml = data.analysis.replace(/```html|```/g, "");
            aiReason.innerHTML = `<div class='prose max-w-none'>${cleanHtml}</div>`;
            
            resultArea.classList.remove('hidden');
        } else {
            alert("Error: " + (data.error || "Unknown error"));
        }
    } catch (err) {
        alert("Failed to connect to backend.");
    } finally {
        loading.classList.add('hidden');
    }
}
